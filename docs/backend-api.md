# Sketchify API Reference

This document summarizes the public HTTP routes exposed by the Sketchify backend (`backend/`). All paths are relative to the API base URL (default `http://localhost:3001` in local development).

## Topics

- [Conventions](#conventions)
- [Health Routes](#health-routes)
- [Authentication Routes](#authentication-routes)
- [Whiteboard Routes](#whiteboard-routes)
- [Collaboration Routes](#collaboration-routes)

## Conventions

- **Authentication** – Protected routes require an `Authorization: Bearer <jwt>` header generated by the authentication endpoints.
- **Content Types** – Requests and responses use `application/json`.
- **Identifiers** – Whiteboards are referenced by an 8-character `roomId`. MongoDB `_id` values appear in responses but are rarely required as input.
- **Error Shape** – Failures return `4xx` or `5xx` codes with `{ "error": "message" }`.
- **Guest behaviour** – REST endpoints never create boards for guests; unauthenticated users rely on socket-driven creation (`join-room`) documented in `docs/sockets.md`.

## Health Routes

| Method | Path | Auth | Description |
| --- | --- | --- | --- |
| `GET` | `/health` | No | Returns `{ "status": "ok", "message": "Server is running" }` for uptime checks. |

## Authentication Routes

All auth routes live under `/api/auth`. Definitions reside in `backend/src/routes/auth.ts` and rely on JWT helpers in `backend/src/middleware/auth.ts`.

| Method | Path | Auth | Description |
| --- | --- | --- | --- |
| `POST` | `/api/auth/register` | No | Creates a user. Body: `{ "username": string, "email": string, "password": string }`. Validates required fields, unique username/email, and password length ≥6. Returns `{ token, user }`. |
| `POST` | `/api/auth/login` | No | Authenticates credentials. Body: `{ "email": string, "password": string }`. Returns `{ token, user }` on success; `401` for invalid credentials. |
| `GET` | `/api/auth/me` | Yes | Returns the authenticated profile `{ user }` when supplied a valid JWT. Useful for rehydrating sessions. |

## Whiteboard Routes

These routes manage board lifecycle and reside in `backend/src/routes/whiteboards.ts`. All require authentication.

| Method | Path | Auth | Description |
| --- | --- | --- | --- |
| `GET` | `/api/whiteboards` | Yes | Lists boards where the requester is owner or collaborator. Response `{ whiteboards: [...] }` omits stroke data for efficiency. |
| `POST` | `/api/whiteboards` | Yes | Creates a board. Body: `{ "name"?: string, "isProtected"?: boolean }`. Generates unique `roomId`, defaults to protected boards. Returns `{ whiteboard }`. |
| `GET` | `/api/whiteboards/:roomId` | Yes | Fetches a board if the requester is owner, collaborator, or the board is public (`isProtected=false`). Returns `{ whiteboard }`. |
| `PUT` | `/api/whiteboards/:roomId` | Yes | Owner-only. Updates `name` and/or `isProtected`. Returns updated `{ whiteboard }`. |
| `DELETE` | `/api/whiteboards/:roomId` | Yes | Owner-only. Removes the board document and responds `{ "message": "Whiteboard deleted successfully" }`. |

### Whiteboard Errors

- `403` – Returned when a non-owner attempts to update/delete or when a user requests a protected board they do not belong to.
- `404` – Board not found for the provided `roomId`.
- `500` – Unexpected persistence or validation issues (see server logs for details).

## Collaboration Routes

Nested under the whiteboard namespace and guarded by ownership rules.

| Method | Path | Auth | Description |
| --- | --- | --- | --- |
| `POST` | `/api/whiteboards/:roomId/invite` | Yes | Owner-only. Body: `{ "email": string }`. Adds the user (if registered) to `collaborators`. Prevents duplicates and inviting the owner. |
| `DELETE` | `/api/whiteboards/:roomId/collaborators/:collaboratorId` | Yes | Owner-only. Removes a collaborator by their `userId`. Returns `{ whiteboard, message }`. |

### Collaboration Errors

- `400` – Missing email or collaborator already present.
- `403` – Requester is not the board owner.
- `404` – Board or invitee not found.
- `500` – Database error while updating collaborators.

---

For socket-driven behaviours (real-time drawing, chat), see `docs/sockets.md`.